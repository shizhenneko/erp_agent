# ERP Agent é¡¹ç›®å®Œæ•´ç‰ˆ

åŸºäº Kimi-K2 çš„æ™ºèƒ½æ•°æ®æŸ¥è¯¢åŠ©æ‰‹ï¼Œå®Œæ•´çš„å‰åç«¯è§£å†³æ–¹æ¡ˆã€‚

---

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**æŠ€æœ¯æ ˆ**ï¼š
- **åç«¯**: Python + FastAPI + WebSocket + PostgreSQL
- **å‰ç«¯**: Vue 3 + Element Plus + Vite
- **AI**: Moonshot Kimi-K2 (å¤§è¯­è¨€æ¨¡å‹)

**æ ¸å¿ƒç‰¹æ€§**ï¼š
- âœ¨ è‡ªç„¶è¯­è¨€è½¬ SQL æŸ¥è¯¢
- ğŸ”„ ReAct å¤šè½®æ¨ç†
- ğŸ“Š å®æ—¶æµå¼è¾“å‡º
- ğŸ’¾ PostgreSQL æ•°æ®åº“
- ğŸ¨ ç°ä»£åŒ– Web ç•Œé¢

---

## ğŸ—‚ é¡¹ç›®ç»“æ„

```
erp_agent/
â”œâ”€â”€ erp_agent/                    # åç«¯æ ¸å¿ƒ
â”‚   â”œâ”€â”€ main.py                  # FastAPI WebSocket æœåŠ¡
â”‚   â”œâ”€â”€ main.py.backup           # åŸå§‹ CLI ç‰ˆæœ¬å¤‡ä»½
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ agent.py             # ERPAgent æ ¸å¿ƒé€»è¾‘
â”‚   â”‚   â”œâ”€â”€ sql_generator.py     # SQL ç”Ÿæˆå™¨
â”‚   â”‚   â”œâ”€â”€ sql_executor.py      # SQL æ‰§è¡Œå™¨
â”‚   â”‚   â”œâ”€â”€ result_analyzer.py   # ç»“æœåˆ†æå™¨
â”‚   â”‚   â””â”€â”€ sql_validator.py     # SQL éªŒè¯å™¨
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ llm.py               # LLM é…ç½®
â”‚   â”‚   â””â”€â”€ database.py          # æ•°æ®åº“é…ç½®
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ prompt_builder.py    # Prompt æ„å»º
â”‚   â”‚   â”œâ”€â”€ date_utils.py        # æ—¥æœŸå·¥å…·
â”‚   â”‚   â””â”€â”€ logger.py            # æ—¥å¿—å·¥å…·
â”‚   â””â”€â”€ prompts/
â”‚       â”œâ”€â”€ system_prompt.txt    # ç³»ç»Ÿæç¤ºè¯
â”‚       â””â”€â”€ schema.txt            # æ•°æ®åº“ Schema
â”‚
â”œâ”€â”€ frontend/                     # å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ QueryInput.vue    # æŸ¥è¯¢è¾“å…¥
â”‚   â”‚   â”‚   â”œâ”€â”€ StreamOutput.vue  # æµå¼è¾“å‡º
â”‚   â”‚   â”‚   â”œâ”€â”€ ResultTable.vue   # ç»“æœè¡¨æ ¼
â”‚   â”‚   â”‚   â””â”€â”€ SQLViewer.vue     # SQL æŸ¥çœ‹å™¨
â”‚   â”‚   â”œâ”€â”€ composables/
â”‚   â”‚   â”‚   â””â”€â”€ useWebSocket.js   # WebSocket å°è£…
â”‚   â”‚   â”œâ”€â”€ views/
â”‚   â”‚   â”‚   â””â”€â”€ Dashboard.vue     # ä¸»é¡µé¢
â”‚   â”‚   â”œâ”€â”€ App.vue
â”‚   â”‚   â””â”€â”€ main.js
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ vite.config.js
â”‚
â”œâ”€â”€ database/                     # æ•°æ®åº“è„šæœ¬
â”‚   â”œâ”€â”€ setup_database.ps1       # æ•°æ®åº“åˆå§‹åŒ–
â”‚   â””â”€â”€ seed_data.sql            # æµ‹è¯•æ•°æ®
â”‚
â”œâ”€â”€ requirements.txt             # Python ä¾èµ–
â”œâ”€â”€ start_backend.bat            # åç«¯å¯åŠ¨è„šæœ¬
â””â”€â”€ start_frontend.bat           # å‰ç«¯å¯åŠ¨è„šæœ¬
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- Python 3.8+
- Node.js 18+
- PostgreSQL 14+
- Moonshot API Key

### 1. å®‰è£…åç«¯ä¾èµ–

```bash
pip install -r requirements.txt
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

ç¼–è¾‘ `erp_agent/.env` æ–‡ä»¶ï¼š

```env
# Moonshot API é…ç½®
MOONSHOT_API_KEY=your_kimi_api_key_here
MOONSHOT_MODEL=kimi-k2

# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=5432
DB_NAME=erp_agent_db
DB_USER=erp_agent_user
DB_PASSWORD=erp_agent_2026

# Agent é…ç½®
MAX_ITERATIONS=5
SQL_TIMEOUT=30
MAX_RESULT_ROWS=1000

# æ—¥å¿—é…ç½®
LOG_LEVEL=INFO
LOG_FILE=logs/agent.log
```

### 3. åˆå§‹åŒ–æ•°æ®åº“

```powershell
cd database
.\setup_database.ps1
```

### 4. å¯åŠ¨æœåŠ¡

#### æ–¹å¼ä¸€ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# å¯åŠ¨åç«¯ï¼ˆç»ˆç«¯ 1ï¼‰
start_backend.bat

# å¯åŠ¨å‰ç«¯ï¼ˆç»ˆç«¯ 2ï¼‰
start_frontend.bat
```

#### æ–¹å¼äºŒï¼šæ‰‹åŠ¨å¯åŠ¨

```bash
# å¯åŠ¨åç«¯ï¼ˆç»ˆç«¯ 1ï¼‰
cd erp_agent
python main.py

# å¯åŠ¨å‰ç«¯ï¼ˆç»ˆç«¯ 2ï¼‰
cd frontend
npm install
npm run dev
```

### 5. è®¿é—®åº”ç”¨

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼šhttp://localhost:3000

---

## ğŸ”Œ API æ¥å£

### WebSocket ç«¯ç‚¹

**åœ°å€**: `ws://localhost:8000/ws`

**åè®®**: è§ `frontend/å¼€å‘æ–‡æ¡£.md`

### REST API ç«¯ç‚¹

#### å¥åº·æ£€æŸ¥
```bash
GET http://localhost:8000/health
```

#### API æ–‡æ¡£
```
http://localhost:8000/docs
```

---

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### æŸ¥è¯¢ç¤ºä¾‹

1. **ç®€å•ç»Ÿè®¡**
   ```
   æœ‰å¤šå°‘åœ¨èŒå‘˜å·¥ï¼Ÿ
   ```

2. **éƒ¨é—¨åˆ†æ**
   ```
   æ¯ä¸ªéƒ¨é—¨æœ‰å¤šå°‘äººï¼Ÿ
   ```

3. **æ’åæŸ¥è¯¢**
   ```
   å·¥èµ„æœ€é«˜çš„å‰10åå‘˜å·¥æ˜¯è°ï¼Ÿ
   ```

4. **æ—¶é—´æŸ¥è¯¢**
   ```
   ä»Šå¹´æ–°å…¥èŒäº†å¤šå°‘äººï¼Ÿ
   ```

5. **å¤æ‚åˆ†æ**
   ```
   ä»å»å¹´åˆ°ä»Šå¹´æ¶¨è–ªå¹…åº¦æœ€å¤§çš„10ä½å‘˜å·¥æ˜¯è°ï¼Ÿ
   ```

6. **å¼‚å¸¸æ£€æµ‹**
   ```
   æœ‰æ²¡æœ‰æ‹–æ¬ å·¥èµ„çš„æƒ…å†µï¼Ÿ
   ```

### æ“ä½œæµç¨‹

1. è¾“å…¥è‡ªç„¶è¯­è¨€é—®é¢˜
2. ç‚¹å‡»"æäº¤æŸ¥è¯¢"æˆ–æŒ‰ `Ctrl + Enter`
3. å®æ—¶æŸ¥çœ‹ Agent æ€è€ƒè¿‡ç¨‹
4. æŸ¥çœ‹ç”Ÿæˆçš„ SQL è¯­å¥
5. æŸ¥çœ‹æŸ¥è¯¢ç»“æœè¡¨æ ¼
6. å¯¼å‡º CSVï¼ˆå¯é€‰ï¼‰

---

## ğŸ“Š æ•°æ®åº“ Schema

### employees è¡¨ï¼ˆå‘˜å·¥è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| employee_id | VARCHAR(20) | å‘˜å·¥ID |
| employee_name | VARCHAR(100) | å‘˜å·¥å§“å |
| department_name | VARCHAR(50) | éƒ¨é—¨åç§° |
| current_level | INTEGER | å½“å‰èŒçº§ |
| hire_date | DATE | å…¥èŒæ—¥æœŸ |
| leave_date | DATE | ç¦»èŒæ—¥æœŸ |

### salaries è¡¨ï¼ˆå·¥èµ„è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| salary_id | SERIAL | å·¥èµ„è®°å½•ID |
| employee_id | VARCHAR(20) | å‘˜å·¥ID |
| payment_date | DATE | å‘è–ªæ—¥æœŸ |
| salary_amount | DECIMAL(10,2) | å·¥èµ„é‡‘é¢ |

è¯¦ç»† Schema è§ `erp_agent/prompts/schema.txt`

---

## ğŸ›  å¼€å‘æŒ‡å—

### åç«¯å¼€å‘

**ç›®å½•**: `erp_agent/`

**è¿è¡Œæµ‹è¯•**:
```bash
cd erp_agent
pytest tests/
```

**æ—¥å¿—ä½ç½®**: `logs/agent.log`

### å‰ç«¯å¼€å‘

**ç›®å½•**: `frontend/`

**å¼€å‘æœåŠ¡å™¨**:
```bash
cd frontend
npm run dev
```

**æ„å»ºç”Ÿäº§ç‰ˆæœ¬**:
```bash
npm run build
```

**é¢„è§ˆç”Ÿäº§æ„å»º**:
```bash
npm run preview
```

---

## ğŸ“ æ–‡æ¡£

- `frontend/å¼€å‘æ–‡æ¡£.md` - å‰ç«¯å¼€å‘æ–‡æ¡£
- `frontend/å¼€å‘å®Œæˆæ€»ç»“.md` - å‰ç«¯å®Œæˆæ€»ç»“
- `åç«¯æ”¹é€ å®Œæˆæ€»ç»“.md` - åç«¯æ”¹é€ æ€»ç»“
- `README_MAIN.md` - åŸå§‹é¡¹ç›®è¯´æ˜

---

## ğŸ› é—®é¢˜æ’æŸ¥

### åç«¯æ— æ³•å¯åŠ¨

1. æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦é…ç½®
2. æ£€æŸ¥æ•°æ®åº“æ˜¯å¦è¿è¡Œ
3. æ£€æŸ¥ API Key æ˜¯å¦æ­£ç¡®
4. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ `logs/agent.log`

### å‰ç«¯æ— æ³•è¿æ¥

1. æ£€æŸ¥åç«¯æ˜¯å¦å¯åŠ¨
2. æ£€æŸ¥ WebSocket åœ°å€é…ç½®
3. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯

### æŸ¥è¯¢æ— ç»“æœ

1. æ£€æŸ¥æ•°æ®åº“æ˜¯å¦æœ‰æ•°æ®
2. æŸ¥çœ‹åç«¯æ—¥å¿—
3. æ£€æŸ¥ API è°ƒç”¨æ˜¯å¦æˆåŠŸ

---

## ğŸ”’ å®‰å…¨è¯´æ˜

- ä»…æ”¯æŒ SELECT æŸ¥è¯¢ï¼Œä¸æ”¯æŒæ•°æ®ä¿®æ”¹
- SQL éªŒè¯å™¨é˜²æ­¢æ³¨å…¥æ”»å‡»
- å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒæ·»åŠ è®¤è¯

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

- ä½¿ç”¨è¿æ¥æ± ç®¡ç†æ•°æ®åº“è¿æ¥
- SQL æŸ¥è¯¢ç»“æœç¼“å­˜
- WebSocket é•¿è¿æ¥å¤ç”¨
- å‰ç«¯ç»„ä»¶æ‡’åŠ è½½

---

## ğŸ¯ æœªæ¥è®¡åˆ’

- [ ] æ·»åŠ ç”¨æˆ·è®¤è¯å’Œæƒé™ç®¡ç†
- [ ] æ”¯æŒæ•°æ®å¯è§†åŒ–å›¾è¡¨
- [ ] æ·»åŠ æŸ¥è¯¢å†å²è®°å½•
- [ ] æ”¯æŒå¤šæ•°æ®æº
- [ ] æ·»åŠ  SQL ç¼–è¾‘å™¨
- [ ] æ”¯æŒå¯¼å‡ºå¤šç§æ ¼å¼

---

## ğŸ“„ è®¸å¯è¯

MIT

---

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

---

## ğŸ“§ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»é¡¹ç›®ç»´æŠ¤è€…ã€‚

---

**é¡¹ç›®ç‰ˆæœ¬**: 1.0.0  
**æœ€åæ›´æ–°**: 2026-01-31  
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª

---

## ğŸ‰ ç‰¹åˆ«æ„Ÿè°¢

æ„Ÿè°¢ Moonshot AI æä¾›çš„ Kimi-K2 æ¨¡å‹æ”¯æŒï¼
