# ERP Agent å‰ç«¯å¼€å‘å®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### Phase 1: é¡¹ç›®åˆå§‹åŒ– âœ…
- åˆ›å»º package.json é…ç½®æ–‡ä»¶
- åˆ›å»º vite.config.js æ„å»ºé…ç½®
- åˆ›å»º index.html å…¥å£æ–‡ä»¶
- åˆ›å»º .env ç¯å¢ƒå˜é‡é…ç½®
- åˆ›å»ºå®Œæ•´çš„é¡¹ç›®ç›®å½•ç»“æ„

### Phase 2: Composable å¼€å‘ âœ…
- å®ç° `useWebSocket.js`
- WebSocket è¿æ¥ç®¡ç†
- è‡ªåŠ¨é‡è¿æœºåˆ¶ï¼ˆæœ€å¤š5æ¬¡ï¼‰
- æ¶ˆæ¯æ”¶å‘å¤„ç†
- è¿æ¥çŠ¶æ€ç®¡ç†

### Phase 3: æ ¸å¿ƒç»„ä»¶å¼€å‘ âœ…

#### QueryInput.vue
- è‡ªç„¶è¯­è¨€æŸ¥è¯¢è¾“å…¥æ¡†
- æ”¯æŒå¤šè¡Œæ–‡æœ¬
- Ctrl+Enter å¿«æ·æäº¤
- å¿«é€ŸæŸ¥è¯¢ç¤ºä¾‹æ ‡ç­¾
- åŠ è½½çŠ¶æ€æ˜¾ç¤º

#### StreamOutput.vue
- æ—¶é—´çº¿å½¢å¼çš„æµå¼è¾“å‡ºå±•ç¤º
- æ”¯æŒå¤šç§äº‹ä»¶ç±»å‹å±•ç¤ºï¼š
  - è¿­ä»£å¼€å§‹
  - æ€è€ƒè¿‡ç¨‹ (ğŸ’­)
  - SQL æ‰§è¡Œ (ğŸ“Š)
  - SQL ç»“æœ (âœ“/âœ—)
  - æœ€ç»ˆç­”æ¡ˆ (ğŸ’¬)
  - æŸ¥è¯¢å®Œæˆ
  - é”™è¯¯ä¿¡æ¯

#### ResultTable.vue
- è¡¨æ ¼å½¢å¼å±•ç¤ºæŸ¥è¯¢ç»“æœ
- åˆ†é¡µåŠŸèƒ½ï¼ˆæ”¯æŒ 10/20/50/100/500 æ¡/é¡µï¼‰
- åˆ—æ’åºåŠŸèƒ½
- å¯¼å‡º CSV åŠŸèƒ½
- è‡ªåŠ¨æ ¼å¼åŒ–æ•°å€¼

#### SQLViewer.vue
- SQL è¯­å¥æŸ¥çœ‹å™¨
- è¯­æ³•é«˜äº®æ ·å¼
- ä¸€é”®å¤åˆ¶åŠŸèƒ½
- æŠ˜å /å±•å¼€åŠŸèƒ½

### Phase 4: ä¸»é¡µé¢æ•´åˆ âœ…
- Dashboard.vue ä¸»é¡µé¢
- æ•´åˆæ‰€æœ‰ç»„ä»¶
- å¤„ç† WebSocket æµå¼æ•°æ®
- å®æ—¶æ›´æ–° SQL å’Œè¡¨æ ¼æ•°æ®
- çŠ¶æ€ç®¡ç†å’Œé”™è¯¯å¤„ç†

### Phase 5: é…ç½®æ–‡ä»¶ âœ…
- package.json
- vite.config.js
- .env
- .gitignore
- README.md
- å¼€å‘æ–‡æ¡£.md

---

## ğŸ“¦ æ–‡ä»¶æ¸…å•

```
frontend/
â”œâ”€â”€ package.json              # é¡¹ç›®é…ç½®
â”œâ”€â”€ vite.config.js            # Vite é…ç½®
â”œâ”€â”€ index.html                # HTML å…¥å£
â”œâ”€â”€ .env                      # ç¯å¢ƒå˜é‡
â”œâ”€â”€ .gitignore                # Git å¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ README.md                 # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ å¼€å‘æ–‡æ¡£.md              # å¼€å‘æ–‡æ¡£
â”‚
â””â”€â”€ src/
    â”œâ”€â”€ main.js               # åº”ç”¨å…¥å£
    â”œâ”€â”€ App.vue               # æ ¹ç»„ä»¶
    â”‚
    â”œâ”€â”€ components/           # ç»„ä»¶ç›®å½•
    â”‚   â”œâ”€â”€ QueryInput.vue
    â”‚   â”œâ”€â”€ StreamOutput.vue
    â”‚   â”œâ”€â”€ ResultTable.vue
    â”‚   â””â”€â”€ SQLViewer.vue
    â”‚
    â”œâ”€â”€ composables/          # Composable ç›®å½•
    â”‚   â””â”€â”€ useWebSocket.js
    â”‚
    â”œâ”€â”€ views/                # é¡µé¢ç›®å½•
    â”‚   â””â”€â”€ Dashboard.vue
    â”‚
    â”œâ”€â”€ styles/               # æ ·å¼ç›®å½•
    â”‚   â””â”€â”€ main.css
    â”‚
    â”œâ”€â”€ stores/               # çŠ¶æ€ç®¡ç†ï¼ˆé¢„ç•™ï¼‰
    â””â”€â”€ utils/                # å·¥å…·å‡½æ•°ï¼ˆé¢„ç•™ï¼‰
```

---

## ğŸš€ å¯åŠ¨æ­¥éª¤

### 1. å®‰è£…ä¾èµ–

```bash
cd frontend
npm install
```

### 2. å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

å‰ç«¯å°†è¿è¡Œåœ¨: http://localhost:3000

---

## ğŸ”— åç«¯æ”¹é€ æŒ‡å—

ä¸ºäº†é…åˆå‰ç«¯ï¼Œéœ€è¦å°† `erp_agent/main.py` æ”¹é€ ä¸º FastAPI WebSocket æœåŠ¡ã€‚

### 1. å®‰è£… FastAPI å’Œä¾èµ–

```bash
pip install fastapi uvicorn websockets
```

### 2. åˆ›å»º WebSocket æœåŠ¡

åœ¨ `erp_agent/main.py` ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š

```python
from fastapi import FastAPI, WebSocket, WebSocketDisconnect
from fastapi.middleware.cors import CORSMiddleware
import json
import asyncio

app = FastAPI(title="ERP Agent API")

# CORS é…ç½®
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_methods=["*"],
    allow_headers=["*"],
)

# Agent å®ä¾‹ï¼ˆå…¨å±€å•ä¾‹ï¼‰
agent_instance = None

def get_or_create_agent():
    global agent_instance
    if agent_instance is None:
        from erp_agent.core import ERPAgent
        from erp_agent.config import get_llm_config, get_database_config, get_agent_config
        
        llm_config = get_llm_config()
        db_config = get_database_config()
        agent_config = get_agent_config()
        
        agent_instance = ERPAgent(llm_config, db_config, agent_config)
        print("âœ“ ERP Agent å·²åˆå§‹åŒ–")
    
    return agent_instance

@app.websocket("/ws")
async def websocket_endpoint(websocket: WebSocket):
    await websocket.accept()
    
    try:
        agent = get_or_create_agent()
        
        while True:
            # æ¥æ”¶å‰ç«¯æ¶ˆæ¯
            data = await websocket.receive_json()
            user_question = data.get("question")
            
            if not user_question:
                continue
            
            # è°ƒç”¨ç°æœ‰çš„ query_stream æµå¼è¾“å‡º
            for chunk in agent.query_stream(user_question):
                # WebSocket å®æ—¶æ¨é€æ¯ä¸ª chunk
                await websocket.send_json({
                    "type": chunk['type'],
                    "data": chunk,
                    "timestamp": chunk.get('timestamp')
                })
                await asyncio.sleep(0.01)
                
    except WebSocketDisconnect:
        print("å®¢æˆ·ç«¯æ–­å¼€è¿æ¥")

if __name__ == "__main__":
    import uvicorn
    uvicorn.run(app, host="0.0.0.0", port=8000)
```

### 3. å¯åŠ¨åç«¯æœåŠ¡

```bash
cd erp_agent
python main.py
```

åç«¯å°†è¿è¡Œåœ¨: ws://localhost:8000/ws

---

## ğŸ”„ å®Œæ•´å¯åŠ¨æµç¨‹

### 1. å¯åŠ¨åç«¯æœåŠ¡

```bash
cd C:\Users\86159\Desktop\erp_agent\erp_agent
python main.py
```

### 2. å¯åŠ¨å‰ç«¯æœåŠ¡

```bash
cd C:\Users\86159\Desktop\erp_agent\frontend
npm install
npm run dev
```

### 3. è®¿é—®å‰ç«¯

æ‰“å¼€æµè§ˆå™¨è®¿é—®: http://localhost:3000

---

## ğŸ“ ä½¿ç”¨è¯´æ˜

### æŸ¥è¯¢ç¤ºä¾‹

è¾“å…¥ä»¥ä¸‹ä»»ä¸€é—®é¢˜è¿›è¡Œæµ‹è¯•ï¼š

- æœ‰å¤šå°‘åœ¨èŒå‘˜å·¥ï¼Ÿ
- æ¯ä¸ªéƒ¨é—¨æœ‰å¤šå°‘äººï¼Ÿ
- å·¥èµ„æœ€é«˜çš„å‰10åå‘˜å·¥æ˜¯è°ï¼Ÿ
- ä»Šå¹´æ–°å…¥èŒäº†å¤šå°‘äººï¼Ÿ
- ä»å»å¹´åˆ°ä»Šå¹´æ¶¨è–ªå¹…åº¦æœ€å¤§çš„10ä½å‘˜å·¥æ˜¯è°ï¼Ÿ
- æœ‰æ²¡æœ‰æ‹–æ¬ å·¥èµ„çš„æƒ…å†µï¼Ÿ

### æ“ä½œæµç¨‹

1. è¾“å…¥é—®é¢˜
2. ç‚¹å‡»"æäº¤æŸ¥è¯¢"æˆ–æŒ‰ Ctrl+Enter
3. å®æ—¶æŸ¥çœ‹ Agent çš„æ€è€ƒè¿‡ç¨‹
4. æŸ¥çœ‹ç”Ÿæˆçš„ SQL è¯­å¥
5. æŸ¥çœ‹æŸ¥è¯¢ç»“æœè¡¨æ ¼
6. å¦‚éœ€è¦ï¼Œå¯¼å‡º CSV

---

## ğŸ¨ ç•Œé¢é¢„è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š ERP Agent æ™ºèƒ½æŸ¥è¯¢ç³»ç»Ÿ              [å·²è¿æ¥]         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  ğŸ’¬ è‡ªç„¶è¯­è¨€æŸ¥è¯¢                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ æœ‰å¤šå°‘åœ¨èŒå‘˜å·¥ï¼Ÿ                                    â”‚ â”‚
â”‚  â”‚                                                    â”‚ â”‚
â”‚  â”‚                                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  [âŒ¨ï¸ Ctrl + Enter å¿«æ·æäº¤]              [æäº¤æŸ¥è¯¢]     â”‚
â”‚                                                          â”‚
â”‚  å¿«é€ŸæŸ¥è¯¢ç¤ºä¾‹ï¼š                                           â”‚
â”‚  [æœ‰å¤šå°‘åœ¨èŒå‘˜å·¥ï¼Ÿ] [æ¯ä¸ªéƒ¨é—¨æœ‰å¤šå°‘äººï¼Ÿ] [...]          â”‚
â”‚                                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âš™ï¸ Agent æ€è€ƒè¿‡ç¨‹                                         â”‚
â”‚  22:31:45.123  [ç¬¬ 1 è½®è¿­ä»£]                             â”‚
â”‚  22:31:45.234  ğŸ’­ æ€è€ƒ: éœ€è¦ç»Ÿè®¡åœ¨èŒå‘˜å·¥æ•°é‡               â”‚
â”‚  22:31:45.345  ğŸ“Š æ‰§è¡Œ SQL: SELECT COUNT(*)...          â”‚
â”‚  22:31:45.567  âœ“ æŸ¥è¯¢æˆåŠŸï¼Œè¿”å› 89 è¡Œæ•°æ®                â”‚
â”‚  22:31:45.789  ğŸ’¬ ç­”æ¡ˆ: å…¬å¸ç›®å‰æœ‰ 89 ååœ¨èŒå‘˜å·¥ã€‚       â”‚
â”‚  22:31:45.901  âœ“ æŸ¥è¯¢å®Œæˆ (è¿­ä»£: 1æ¬¡, è€—æ—¶: 0.8ç§’)     â”‚
â”‚                                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“„ ç”Ÿæˆçš„ SQL è¯­å¥          [å¤åˆ¶] [æ”¶èµ·]                â”‚
â”‚  SELECT COUNT(*) FROM employees WHERE leave_date IS NULL â”‚
â”‚                                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“Š æŸ¥è¯¢ç»“æœ              [89 è¡Œ] [1 åˆ—]  [å¯¼å‡º CSV]       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ #  â”‚ count                                          â”‚ â”‚
â”‚  â”‚ 1  â”‚ 89                                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  å…± 1 é¡µ                   [1] 2 3 ...                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ› é—®é¢˜æ’æŸ¥

### å‰ç«¯æ— æ³•è¿æ¥åˆ°åç«¯

1. æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨
2. æ£€æŸ¥ `.env` ä¸­çš„ `VITE_WS_URL` æ˜¯å¦æ­£ç¡®
3. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯

### WebSocket è¿æ¥å¤±è´¥

1. æ£€æŸ¥åç«¯æ˜¯å¦æ­£ç¡®æ”¹é€ ä¸º WebSocket æœåŠ¡
2. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
3. æ£€æŸ¥ç«¯å£ 8000 æ˜¯å¦è¢«å ç”¨

### æŸ¥è¯¢æ— å“åº”

1. æ£€æŸ¥ ERPAgent åˆå§‹åŒ–æ˜¯å¦æˆåŠŸ
2. æ£€æŸ¥æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸
3. æ£€æŸ¥ API Key æ˜¯å¦é…ç½®æ­£ç¡®

---

## ğŸ“Š æŠ€æœ¯äº®ç‚¹

1. **å®æ—¶æ€§** - WebSocket å®ç°çœŸæ­£çš„å®æ—¶æµå¼è¾“å‡º
2. **å“åº”å¼** - Vue 3 Composition API æä¾›ä¼˜ç§€çš„å“åº”å¼ä½“éªŒ
3. **ç»„ä»¶åŒ–** - é«˜åº¦æ¨¡å—åŒ–çš„ç»„ä»¶è®¾è®¡ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•
4. **è‡ªåŠ¨åŒ–** - è‡ªåŠ¨é‡è¿æœºåˆ¶ä¿è¯è¿æ¥ç¨³å®šæ€§
5. **ç¾è§‚æ€§** - Element Plus æä¾›ä¸“ä¸šçš„ä¼ä¸šçº§ UI
6. **å®ç”¨æ€§** - æ”¯æŒ CSV å¯¼å‡ºã€åˆ†é¡µã€æ’åºç­‰å®ç”¨åŠŸèƒ½

---

## ğŸ¯ ä¸‹ä¸€æ­¥å»ºè®®

1. **æ·»åŠ å†å²æŸ¥è¯¢è®°å½•** - ä¿å­˜ç”¨æˆ·çš„æŸ¥è¯¢å†å²ï¼Œæ”¯æŒå¿«é€Ÿå›çœ‹
2. **æ·»åŠ æ•°æ®å¯è§†åŒ–** - ä½¿ç”¨ ECharts æ·»åŠ å›¾è¡¨å±•ç¤ºåŠŸèƒ½
3. **æ·»åŠ æŸ¥è¯¢æ”¶è—** - æ”¯æŒæ”¶è—å¸¸ç”¨æŸ¥è¯¢
4. **æ·»åŠ ç”¨æˆ·è®¤è¯** - å®ç°ç™»å½•å’Œæƒé™ç®¡ç†
5. **æ·»åŠ å›½é™…åŒ–** - æ”¯æŒå¤šè¯­è¨€åˆ‡æ¢

---

**å¼€å‘å®Œæˆæ—¶é—´**: 2026-01-31  
**å‰ç«¯ç‰ˆæœ¬**: 1.0.0  
**çŠ¶æ€**: âœ… å‰ç«¯å¼€å‘å®Œæˆï¼Œç­‰å¾…åç«¯æ”¹é€ å’Œè”è°ƒ
