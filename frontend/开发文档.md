# ERP Agent å‰ç«¯å¼€å‘æ–‡æ¡£

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬æ–‡æ¡£æè¿°åŸºäºVue 3 + Element Plus + WebSocketçš„ERP Agentå‰ç«¯å¼€å‘æ–¹æ¡ˆã€‚

**æŠ€æœ¯æ ˆ**ï¼š
- å‰ç«¯æ¡†æ¶ï¼šVue 3 (Composition API)
- UIç»„ä»¶åº“ï¼šElement Plus
- æ„å»ºå·¥å…·ï¼šVite
- é€šä¿¡æ–¹å¼ï¼šWebSocket
- çŠ¶æ€ç®¡ç†ï¼šPinia

**åç«¯æ¥å£**ï¼š
- WebSocketç«¯ç‚¹ï¼š`ws://localhost:8000/ws`
- ç°æœ‰åç«¯ï¼šåŸºäºPythonçš„ERPAgentï¼Œæ”¯æŒæµå¼è¾“å‡º

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½éœ€æ±‚

1. **è‡ªç„¶è¯­è¨€æŸ¥è¯¢è¾“å…¥** - æ”¯æŒå¤šè¡Œæ–‡æœ¬è¾“å…¥ï¼Œå¿«æ·é”®æäº¤
2. **SQLæŸ¥è¯¢æ˜¾ç¤º** - å±•ç¤ºAgentç”Ÿæˆçš„SQLè¯­å¥
3. **æµå¼è¾“å‡ºå±•ç¤º** - å®æ—¶æ˜¾ç¤ºAgentçš„æ€è€ƒè¿‡ç¨‹
4. **æ•°æ®è¡¨æ ¼å±•ç¤º** - ä»¥è¡¨æ ¼å½¢å¼å±•ç¤ºæŸ¥è¯¢ç»“æœ

---

## ğŸ“ é¡¹ç›®ç›®å½•ç»“æ„

```
frontend/
â”œâ”€â”€ public/
â”‚   â””â”€â”€ favicon.ico
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ assets/
â”‚   â”‚   â””â”€â”€ logo.png
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ QueryInput.vue          # æŸ¥è¯¢è¾“å…¥ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ StreamOutput.vue        # æµå¼è¾“å‡ºç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ResultTable.vue         # ç»“æœè¡¨æ ¼ç»„ä»¶
â”‚   â”‚   â””â”€â”€ SQLViewer.vue           # SQLæŸ¥çœ‹å™¨ç»„ä»¶
â”‚   â”œâ”€â”€ composables/
â”‚   â”‚   â””â”€â”€ useWebSocket.js         # WebSocketå°è£…
â”‚   â”œâ”€â”€ stores/
â”‚   â”‚   â””â”€â”€ queryStore.js           # æŸ¥è¯¢çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ styles/
â”‚   â”‚   â””â”€â”€ main.css                # å…¨å±€æ ·å¼
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ format.js               # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ views/
â”‚   â”‚   â””â”€â”€ Dashboard.vue           # ä¸»é¡µé¢
â”‚   â”œâ”€â”€ App.vue
â”‚   â””â”€â”€ main.js
â”œâ”€â”€ .env
â”œâ”€â”€ .gitignore
â”œâ”€â”€ index.html
â”œâ”€â”€ package.json
â”œâ”€â”€ vite.config.js
â””â”€â”€ README.md
```

---

## ğŸ”Œ WebSocketæ¶ˆæ¯åè®®

### å‰ç«¯å‘é€

```json
{
  "action": "query",
  "question": "æœ‰å¤šå°‘åœ¨èŒå‘˜å·¥ï¼Ÿ"
}
```

### åç«¯æ¨é€ï¼ˆæµå¼ï¼‰

#### 1. è¿­ä»£å¼€å§‹
```json
{
  "type": "iteration_start",
  "iteration": 1,
  "timestamp": 1706739200.0
}
```

#### 2. æ€è€ƒè¿‡ç¨‹
```json
{
  "type": "thought",
  "thought": "éœ€è¦ç»Ÿè®¡åœ¨èŒå‘˜å·¥æ•°é‡",
  "iteration": 1,
  "timestamp": 1706739200.1
}
```

#### 3. SQLæ‰§è¡Œ
```json
{
  "type": "sql_executing",
  "sql": "SELECT COUNT(*) FROM employees WHERE leave_date IS NULL",
  "iteration": 1,
  "timestamp": 1706739200.2
}
```

#### 4. SQLç»“æœ
```json
{
  "type": "sql_result",
  "row_count": 89,
  "data": [[89]],
  "success": true,
  "iteration": 1,
  "timestamp": 1706739200.5
}
```

#### 5. æœ€ç»ˆç­”æ¡ˆ
```json
{
  "type": "answer",
  "answer": "å…¬å¸ç›®å‰æœ‰ 89 ååœ¨èŒå‘˜å·¥ã€‚",
  "iteration": 1,
  "timestamp": 1706739200.8
}
```

#### 6. æŸ¥è¯¢å®Œæˆ
```json
{
  "type": "final",
  "success": true,
  "iterations": 1,
  "total_time": 0.8,
  "answer": "å…¬å¸ç›®å‰æœ‰ 89 ååœ¨èŒå‘˜å·¥ã€‚",
  "timestamp": 1706739200.9
}
```

---

## ğŸ§© ç»„ä»¶è¯¦ç»†è®¾è®¡

### 1. QueryInput.vue

**åŠŸèƒ½**ï¼šæ¥æ”¶ç”¨æˆ·è¾“å…¥çš„è‡ªç„¶è¯­è¨€æŸ¥è¯¢

**Props**ï¼šæ— 

**Emits**ï¼š
- `submit(question: string)` - æäº¤æŸ¥è¯¢

**çŠ¶æ€**ï¼š
- `question` (string) - è¾“å…¥çš„æŸ¥è¯¢å†…å®¹
- `isLoading` (boolean) - æ˜¯å¦æ­£åœ¨æŸ¥è¯¢

**äº¤äº’**ï¼š
- æ”¯æŒå¤šè¡Œæ–‡æœ¬è¾“å…¥
- Ctrl+Enter å¿«æ·é”®æäº¤
- æŸ¥è¯¢ä¸­ç¦ç”¨è¾“å…¥

---

### 2. StreamOutput.vue

**åŠŸèƒ½**ï¼šå®æ—¶å±•ç¤ºAgentçš„æµå¼è¾“å‡º

**Props**ï¼š
- `streamData` (Array) - æµå¼æ•°æ®åˆ—è¡¨

**Emits**ï¼šæ— 

**çŠ¶æ€**ï¼šæ— 

**å±•ç¤ºå†…å®¹**ï¼š
- æ—¶é—´çº¿å½¢å¼å±•ç¤º
- ä¸åŒç±»å‹äº‹ä»¶ç”¨ä¸åŒå›¾æ ‡ï¼š
  - ğŸ’­ æ€è€ƒ (thought)
  - âš™ï¸ SQLæ‰§è¡Œ (sql_executing)
  - âœ“ SQLç»“æœ (sql_result)
  - ğŸ’¬ ç­”æ¡ˆ (answer)
  - âœ— é”™è¯¯ (error)

---

### 3. ResultTable.vue

**åŠŸèƒ½**ï¼šä»¥è¡¨æ ¼å½¢å¼å±•ç¤ºæŸ¥è¯¢ç»“æœ

**Props**ï¼š
- `tableData` (Array) - è¡¨æ ¼æ•°æ®
- `columns` (Array) - åˆ—å

**Emits**ï¼šæ— 

**çŠ¶æ€**ï¼šæ— 

**ç‰¹æ€§**ï¼š
- æ”¯æŒåˆ†é¡µ
- æ”¯æŒæ’åº
- æ”¯æŒå¯¼å‡ºCSV

---

### 4. SQLViewer.vue

**åŠŸèƒ½**ï¼šæŸ¥çœ‹ç”Ÿæˆçš„SQLè¯­å¥

**Props**ï¼š
- `sql` (string) - SQLè¯­å¥

**Emits**ï¼šæ— 

**çŠ¶æ€**ï¼šæ— 

**ç‰¹æ€§**ï¼š
- SQLè¯­æ³•é«˜äº®
- ä¸€é”®å¤åˆ¶
- æŠ˜å /å±•å¼€

---

### 5. Dashboard.vue (ä¸»é¡µé¢)

**åŠŸèƒ½**ï¼šæ•´åˆæ‰€æœ‰ç»„ä»¶çš„ä¸»é¡µé¢

**å¸ƒå±€**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ERP Agent æ™ºèƒ½æŸ¥è¯¢ç³»ç»Ÿ                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [æŸ¥è¯¢è¾“å…¥æ¡†]                           â”‚
â”‚                                         â”‚
â”‚  [æµå¼è¾“å‡ºåŒºåŸŸ]                         â”‚
â”‚                                         â”‚
â”‚  [SQLæŸ¥çœ‹å™¨]                            â”‚
â”‚                                         â”‚
â”‚  [ç»“æœè¡¨æ ¼]                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ Composableè®¾è®¡

### useWebSocket.js

**åŠŸèƒ½**ï¼šå°è£…WebSocketè¿æ¥å’Œæ¶ˆæ¯å¤„ç†

**è¿”å›å€¼**ï¼š
- `isConnected` (Ref<boolean>) - è¿æ¥çŠ¶æ€
- `streamData` (Ref<Array>) - æµå¼æ•°æ®
- `send(message)` (Function) - å‘é€æ¶ˆæ¯
- `connect()` (Function) - ä¸»åŠ¨è¿æ¥
- `disconnect()` (Function) - æ–­å¼€è¿æ¥

**ç”Ÿå‘½å‘¨æœŸ**ï¼š
- ç»„ä»¶æŒ‚è½½æ—¶çš„è‡ªåŠ¨è¿æ¥
- ç»„ä»¶å¸è½½æ—¶è‡ªåŠ¨æ–­å¼€
- æ–­çº¿è‡ªåŠ¨é‡è¿

---

## ğŸ“¦ ä¾èµ–æ¸…å•

```json
{
  "dependencies": {
    "vue": "^3.4.0",
    "element-plus": "^2.5.0",
    "pinia": "^2.1.0",
    "@element-plus/icons-vue": "^2.3.0"
  },
  "devDependencies": {
    "@vitejs/plugin-vue": "^5.0.0",
    "vite": "^5.0.0"
  }
}
```

---

## ğŸ¨ æ ·å¼è§„èŒƒ

**ä¸»é¢˜è‰²**ï¼š
- ä¸»è‰²ï¼š#409EFF (Element Plus è“)
- æˆåŠŸï¼š#67C23A
- è­¦å‘Šï¼š#E6A23C
- å±é™©ï¼š#F56C6C
- ä¿¡æ¯ï¼š#909399

**å¸ƒå±€**ï¼š
- å®¹å™¨æœ€å¤§å®½åº¦ï¼š1200px
- å†…è¾¹è·ï¼š20px
- é—´è·ï¼š16px

**å­—ä½“**ï¼š
- å­—ä½“æ—ï¼š-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif
- åŸºç¡€å­—å·ï¼š14px

---

## ğŸ”§ é…ç½®æ–‡ä»¶

### vite.config.js

```javascript
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'

export default defineConfig({
  plugins: [vue()],
  server: {
    port: 3000,
    proxy: {
      '/ws': {
        target: 'ws://localhost:8000',
        ws: true
      }
    }
  }
})
```

### .env

```
VITE_WS_URL=ws://localhost:8000/ws
VITE_API_BASE_URL=http://localhost:8000
```

---

## ğŸ“Š çŠ¶æ€ç®¡ç†

### queryStore.js (Pinia)

**çŠ¶æ€**ï¼š
- `queries` (Array) - å†å²æŸ¥è¯¢è®°å½•
- `currentQuery` (Object) - å½“å‰æŸ¥è¯¢
- `isLoading` (boolean) - åŠ è½½çŠ¶æ€

**Actions**ï¼š
- `addQuery(query)` - æ·»åŠ æŸ¥è¯¢è®°å½•
- `setCurrentQuery(query)` - è®¾ç½®å½“å‰æŸ¥è¯¢
- `setLoading(loading)` - è®¾ç½®åŠ è½½çŠ¶æ€

---

## ğŸš€ å¼€å‘æ­¥éª¤

### Phase 1: é¡¹ç›®åˆå§‹åŒ–
1. åˆ›å»ºVite + Vue 3é¡¹ç›®
2. å®‰è£…ä¾èµ–ï¼ˆElement Plus, Piniaï¼‰
3. é…ç½®Vite
4. åˆ›å»ºåŸºç¡€ç›®å½•ç»“æ„

### Phase 2: Composableå¼€å‘
1. å®ç°useWebSocket.js
2. æµ‹è¯•WebSocketè¿æ¥

### Phase 3: ç»„ä»¶å¼€å‘
1. QueryInput.vue
2. StreamOutput.vue
3. ResultTable.vue
4. SQLViewer.vue

### Phase 4: é¡µé¢æ•´åˆ
1. Dashboard.vue
2. App.vue
3. å…¨å±€æ ·å¼

### Phase 5: è”è°ƒæµ‹è¯•
1. å¯åŠ¨åç«¯æœåŠ¡
2. å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨
3. æµ‹è¯•å®Œæ•´æµç¨‹

---

## ğŸ§ª æµ‹è¯•è®¡åˆ’

### å•å…ƒæµ‹è¯•
- [ ] useWebSocketè¿æ¥æµ‹è¯•
- [ ] useWebSocketæ¶ˆæ¯æ”¶å‘æµ‹è¯•
- [ ] QueryInputç»„ä»¶æµ‹è¯•

### é›†æˆæµ‹è¯•
- [ ] WebSocketä¸åç«¯è¿æ¥
- [ ] å®Œæ•´æŸ¥è¯¢æµç¨‹
- [ ] æµå¼è¾“å‡ºå±•ç¤º
- [ ] é”™è¯¯å¤„ç†

### æ‰‹åŠ¨æµ‹è¯•
- [ ] æµ‹è¯•10ä¸ªæ ‡å‡†æŸ¥è¯¢é—®é¢˜
- [ ] æµ‹è¯•ç½‘ç»œæ–­å¼€é‡è¿
- [ ] æµ‹è¯•é•¿æ–‡æœ¬è¾“å…¥

---

## ğŸ“ å¾…åŠäº‹é¡¹

- [x] åˆ›å»ºå¼€å‘æ–‡æ¡£
- [ ] Phase 1: é¡¹ç›®é¡¹ç›®
- [ ] Phase 2: Composableå¼€å‘
- [ ] Phase 3: ç»„ä»¶å¼€å‘
- [ ] Phase 4: é¡µé¢æ•´åˆ
- [ ] Phase 5: è”è°ƒæµ‹è¯•

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**æœ€åæ›´æ–°**ï¼š2026-01-31  
**ä½œè€…**ï¼šopencode
