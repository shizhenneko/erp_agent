# ERP 数据库 Schema 说明

## 数据库基本信息
- **数据库名称**: erp_agent_db
- **字符集**: UTF-8
- **数据库系统**: PostgreSQL 14+

---

## 表结构详细说明

### 1. employees 表（员工表）

存储员工的基本信息，包括在职和离职员工。

#### 字段说明

| 字段名            | 数据类型        | 约束条件                  | 说明                                  |
|------------------|----------------|--------------------------|---------------------------------------|
| employee_id      | VARCHAR(20)    | PRIMARY KEY              | 员工唯一标识，格式：EMP001, EMP002... |
| employee_name    | VARCHAR(100)   | NOT NULL                 | 员工姓名                               |
| department_name  | VARCHAR(50)    | NOT NULL                 | 所属部门名称（A部门、B部门等）          |
| current_level    | INTEGER        | NOT NULL, 1-10           | 当前职级（1-10级，10级最高）            |
| hire_date        | DATE           | NOT NULL                 | 入职日期                               |
| leave_date       | DATE           | NULL（在职）/ NOT NULL（离职） | 离职日期                               |
| created_at       | TIMESTAMP      | DEFAULT CURRENT_TIMESTAMP | 记录创建时间                           |
| updated_at       | TIMESTAMP      | DEFAULT CURRENT_TIMESTAMP | 记录更新时间                           |

#### 索引

- `idx_employees_department` - 部门索引（加速按部门查询）
- `idx_employees_hire_date` - 入职日期索引（加速时间范围查询）
- `idx_employees_active` - 在职员工索引（仅索引 leave_date IS NULL 的记录）

---

### 2. salaries 表（工资表）

存储员工每月的工资发放记录。

#### 字段说明

| 字段名            | 数据类型          | 约束条件                    | 说明                                    |
|------------------|------------------|----------------------------|----------------------------------------|
| salary_id        | SERIAL           | PRIMARY KEY                | 工资记录自增主键                         |
| employee_id      | VARCHAR(20)      | FOREIGN KEY, NOT NULL      | 关联 employees 表的员工ID                |
| payment_date     | DATE             | NOT NULL                   | 工资发放日期（每月25号）                  |
| salary_amount    | DECIMAL(10,2)    | NOT NULL, >= 0             | 工资金额（精确到分）                      |
| created_at       | TIMESTAMP        | DEFAULT CURRENT_TIMESTAMP  | 记录创建时间                             |

#### 索引

- `idx_salaries_payment_date` - 发薪日期索引（加速时间范围查询）
- `idx_salaries_employee_date` - 复合索引（员工ID + 发薪日期，加速关联查询）

---

## 表关系

```
employees (1) ←──────── (N) salaries
    │                        │
    └─ employee_id ─────────┘
```

- **一对多关系**: 一个员工可以有多条工资记录（每月一条）
- **外键约束**: salaries.employee_id 引用 employees.employee_id
- **级联删除**: 删除员工时，自动删除其所有工资记录

---

## SQL 查询建议

**推荐做法**：在 SQL 中使用明确的日期范围或明确的时间提取条件
```sql
WHERE payment_date BETWEEN 'YYYY-01-01' AND 'YYYY-12-31'
WHERE EXTRACT(YEAR FROM payment_date) = YYYY
```

**相对时间区间查询**（仅当问题明确为相对时间时）：
```sql
WHERE payment_date >= CURRENT_DATE - INTERVAL '3 months'
WHERE hire_date >= CURRENT_DATE - INTERVAL '1 year'
```

## PostgreSQL 特性说明

### 数据类型注意事项
- **NULL 值判断**: 必须使用 `IS NULL` 或 `IS NOT NULL`，不能使用 `= NULL`
- **日期格式**: 标准格式为 'YYYY-MM-DD'
- **金额精度**: DECIMAL(10,2) 保留两位小数

### 常用函数
- **时间函数**: EXTRACT(), DATE_TRUNC(), CURRENT_DATE
- **聚合函数**: COUNT(), SUM(), AVG(), MAX(), MIN()
- **窗口函数**: ROW_NUMBER(), RANK(), DENSE_RANK() OVER (...)
- **序列生成**: generate_series()
- **空值处理**: COALESCE()

### 权限说明
- 查询用户仅有 **SELECT** 权限
- 不能进行 INSERT、UPDATE、DELETE、DROP 等修改操作

---

**Schema 版本**: 1.0
